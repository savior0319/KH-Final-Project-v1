<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="common">

	<!-- 페이징 처리 - 리스트 불러오기 -->
	<select id="getList" parameterType="commentPageData" resultType="comment">

		SELECT CMT.CMT_INDEX AS cmtIndex,
		CMT.POST_INDEX AS postIndex,
		MB.MB_NICKNAME AS mbNickname,
		MB.MB_IMAGE AS mbImage,
		CMT.CMT_CONTENT AS cmtContent,
		CMT.CMT_DATETIME AS cmtDateTime,
		CMT.CMT_LIKE AS cmtLike,
		CMT.CMT_BLAME
		AS cmtBlame
		FROM (SELECT BOARD_COMMENT_TBL.*,
		ROW_NUMBER() OVER(ORDER BY
		CMT_INDEX DESC) AS NUM FROM BOARD_COMMENT_TBL WHERE POST_INDEX =
		#{indexNo}) CMT, MEMBER_TBL MB WHERE CMT.MB_INDEX = MB.MB_INDEX(+) AND
		NUM BETWEEN #{start}
		AND #{end} ORDER BY 1 DESC
	</select>

	<!-- 페이징 처리 - 내비게이션 생성 -->
	<select id="getNavi" resultType="java.lang.Integer">
		select count(*) as totalCount
		from BOARD_COMMENT_TBL WHERE POST_INDEX = #{indexNo}
	</select>

	<!-- 댓글 등록 -->
	<select id="addComment" parameterType="comment">
		INSERT INTO
		BOARD_COMMENT_TBL
		VALUES(BOARD_COMMENT_TBL_SEQ.NEXTVAL, #{postIndex}, #{mbIndex}, #{cmtContent}, SYSDATE, 0, 0)
	</select>
	
	<!-- 댓글 삭제 -->
	<delete id="deleteComment" parameterType="comment">
	DELETE FROM BOARD_COMMENT_TBL WHERE CMT_INDEX = #{commentIndex}
	</delete>

</mapper>
